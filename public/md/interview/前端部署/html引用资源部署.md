## html引用资源部署
### 简单部署流程
- 使用构建工具打包前端代码，生成dist文件夹。
- 使用nginx起一个web服务器，将dist文件夹放到指定的路径下，配置nginx的访问路径。
- 对于请求接口使用proxy_pass进行转发，解决跨域的问题。
- 每次更新部署替换dist文件夹即可。
### html引用资源使用固定文件名
- 当为了节省带宽，提升网页性能给a.css资源添加强缓存时，更新a.css资源内容会导致用户使用本地缓存无法请求到最新的资源。

```
<link rel="stylesheet" href="a.css" />
```
### 更新html引用资源的资源路径
- 通过更新html中引用的资源路径，让浏览器主动放弃缓存，加载新资源。
- 当页面引用了3个css文件，而某次上线只改了其中的a.css，如果所有链接都更新版本，就会导致另外两个没有更新的css文件的缓存也失效。
```
<link rel="stylesheet" href="a.css?v=1.0.0" />
<link rel="stylesheet" href="b.css?v=1.0.0" />
<link rel="stylesheet" href="c.css?v=1.0.0" />
```
### 使用数据摘要算法更新html引用资源的资源路径
- 让html中引用的资源路径的修改与文件内容关联，只有文件内容变化，才会导致相应资源路径的变更，从而实现文件级别的精确缓存控制。
```
<link rel="stylesheet" href="a.css?v=f23cde" />
<link rel="stylesheet" href="b.css?v=f34cde" />
<link rel="stylesheet" href="c.css?v=f45cde" />
```
### html和html引用资源分别部署
- 为了进一步提升网站性能，html引用资源会被部署到CDN节点上，html中引用的资源路径也会变成对应部署的CDN节点路径。
### 部署应用时先部署html页面还是先部署html引用资源
> 先部署html引用资源，再部署html页面，问题少一些。

- 先部署html页面，再部署html引用资源。
  1. 在二者部署的时间间隔内，如果有用户访问页面，就会在新的页面结构中加载旧的资源，并且把这个旧版本的资源当做新版本缓存起来。
  2. 用户访问到了一个样式错乱的页面，除非手动刷新，否则在资源缓存过期之前，页面会一直显示错误。
- 先部署html引用资源，再部署html页面。
  1. 在二者部署的时间间隔内，有旧版本资源本地缓存的用户访问网站，由于请求的页面是旧版本的，资源引用没有改变，浏览器将直接使用本地缓存，这种情况下页面展现正常。
  2. 没有本地缓存或者缓存过期的用户访问网站，就会出现旧版本页面加载新版本资源的情况，导致页面执行错误，但当页面完成部署，这部分用户再次访问页面又会恢复正常了。
### 覆盖式发布
- 之所以有部署应用时先部署html页面还是先部署html引用资源的问题是因为html引用资源的覆盖式发布，使用新发布html引用资源覆盖已发布的html引用资源。使用非覆盖式发布会解决该问题。
### 非覆盖式发布
- 用文件的摘要信息对html引用资源文件进行重命名，把摘要信息放到html引用资源文件名中，这样内容有修改的资源就变成了一个新的文件发布到线上，不会覆盖已有的资源文件。
- 部署过程中先部署html引用资源，再部署html页面。
```
<link rel="stylesheet" href="a_f23cde.css" />
```
### html引用资源部署优化方案
- 配置超长时间的本地缓存：节省带宽，提高性能。
- 采用内容摘要作为缓存更新依据：精确的缓存控制。
- html引用资源CDN部署：优化网络请求。
- 更新html引用资源文件名实现非覆盖式发布：平滑升级。
