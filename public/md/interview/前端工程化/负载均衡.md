## 负载均衡
- 随着用户数量的增长和业务规模的扩大，单一的服务器无法满足高并发、大流量的需求。
- 单个服务器很难通过增加硬件资源来满足需求，成本高昂且存在性能瓶颈，更为严重的是所有请求都发送到同一台服务器，一旦该服务器出现故障整个服务就会中断。
- 通过增加服务器数量，负载均衡将大量的网络请求分发到多个服务器上进行处理，从而提高系统的处理能力，保证服务的高可用性。
### 负载均衡好处
- 提高性能和吞吐量：负载均衡可以将请求分发到多个后端服务器上，使得每个服务器处理的负载更加均衡。这样可以提高系统的整体性能和吞吐量，缩短用户的等待时间，提升用户体验。
- 增强系统可用性：如通过将负载分散到多个服务器上，即使其中一个服务器发生故障，其他服务器仍然可以继续处理请求，从而提高系统的可用性和可靠性。负载均衡器可以自动检测故障并将请求转发到可用的服务器上，减少服务中断的风险。
- 实现系统的伸缩性：负载均衡器可以根据实际负载情况动态地添加或删除后端服务器，实现系统的弹性扩展。当负载增加时，可以添加更多的服务器来分担负载；当负载减少时，可以减少服务器的数量以节省资源。
- 解决高并发和高可用性问题：在互联网架构中，负载均衡可以有效地解决高并发和高可用性的问题。通过将请求分发到多个服务器上，可以平衡负载，避免单个服务器过载，从而提供更好的用户体验。
- 提高资源利用率：负载均衡可以根据服务器的性能指标和负载情况，将请求分发到最适合的服务器上。这样可以更好地利用服务器的资源，提高资源的利用率。
### 负载均衡的工作原理
1. 请求接收：当用户发出请求时，请求首先会被发送到负载均衡器。
2. 请求分发：负载均衡器会根据某种负载均衡算法，如轮询、最少连接、源地址哈希等，将请求分发到后端的某个服务器。这个过程中负载均衡器会考虑到后端服务器的当前负载情况，以确保所有服务器的负载都保持在一个合理的范围内。
3. 响应返回：后端服务器处理完用户的请求后，会将响应返回给负载均衡器，负载均衡器再将响应返回给用户。
4. 健康检查：负载均衡器会定期对后端服务器进行健康检查，如果发现某个服务器出现故障，负载均衡器会将该服务器从服务列表中移除，不再向其分发请求。当服务器恢复正常后，负载均衡器会再次将其加入到服务列表中。
### 硬件负载均衡
- 硬件负载均衡器是专门的物理设备，这类设备性能强劲、功能强大、具有高性能和高可靠性，适合处理大规模的网络流量，但价格昂贵，一般只有大公司才会考虑使用此类设备。
### 软件负载均衡
- 软件负载均衡器是运行在普通服务器上的软件，它们的成本较低，扩展性好。软件负载均衡器可以根据需要轻松地增加或减少，适合云计算和虚拟化环境。
- 常见的有Nginx和LVS，其中Nginx是软件的七层负载均衡，LVS是Linux内核的四层负载均衡。
### 四层负载均衡
- 四层负载均衡工作在网络模型的传输层，主要根据请求的IP地址和端口号来进行负载均衡。四层负载均衡器不会关心请求的具体内容，只是简单地将请求转发到后端的某个服务器。
- 四层负载均衡的处理速度较快，但是灵活性较低。
### 七层负载均衡
- 七层负载均衡工作在网络模型的应用层，可以根据请求的具体内容（如 URL、请求头、请求方法等）来进行负载均衡。七层负载均衡器可以理解请求的具体内容，因此可以实现更复杂的负载均衡策略，如基于URL的负载均衡、基于会话的负载均衡等。
- 由于需要处理请求的具体内容，七层负载均衡的处理速度相对较慢。
### 全局负载均衡
- 全局负载均衡主要用于在全球范围内的多个数据中心之间进行负载均衡。它可以根据各个数据中心的负载情况、网络状况、客户端的地理位置等因素，智能地将用户的请求分发到最合适的数据中心。从而减少网络延迟，提高服务的性能和可用性。
### 局部负载均衡
- 局部负载均衡主要用于在单个数据中心内的多个服务器之间进行负载均衡。它通常使用更精细的负载均衡策略，如轮询、最少连接、源地址哈希等，以实现更高效的资源利用和更好的性能。
### DNS负载均衡
- DNS负载均衡可以实现全局负载均衡。DNS服务器可以根据客户端的地理位置、网络状况等因素，根据域名的DNS解析选择最适合的服务器IP返回给客户端，从而实现全局的流量分发。
- DNS负载均衡也有一些限制。
  1. DNS查询结果可能会被客户端或中间网络设备缓存，导致负载均衡策略不能实时生效。
  2. DNS负载均衡无法实现会话保持，也无法根据服务器的实时负载状况、服务器性能、运行状态进行动态调整，可能分发到有问题的服务器。
- DNS负载均衡通常和其他负载均衡技术（如四层负载均衡、七层负载均衡）配合使用，以实现更高效的负载均衡。
### 服务端负载均衡
- 负载均衡器位于服务端，所有的客户端请求都会首先发送到负载均衡器，负载均衡器会根据负载均衡算法将请求分发到后端的某个服务器。
- 这种方式的优点是实现简单，透明度高，客户端无需进行任何特殊处理。但是所有的请求都需要经过负载均衡器，可能会成为性能瓶颈。
- 负载均衡器根据服务器的实时负载状况、服务器性能、运行状态进行动态调整，有问题的服务器不会分发。
### 客户端负载均衡
- 负载均衡的逻辑实现在客户端。客户端会从服务注册中心获取所有可用的服务列表，然后根据负载均衡算法选择一个服务进行请求。
- 这种方式的优点是可以避免服务端负载均衡器成为性能瓶颈，但是需要在客户端实现负载均衡逻辑，增加了客户端的复杂性。
### [负载均衡算法](https://www.zhihu.com/question/61783920/answer/3223446673)
- 轮询算法
- 加权轮询算法
- 最少连接算法
- 加权最少连接算法
- 源地址哈希算法
- URL哈希算法
- 最短响应时间算法
### 负载均衡算法的选择
- 服务器的性能是否均匀：如果服务器的性能差异较大，那么加权轮询或加权最少连接算法可能更合适，因为这两种算法可以通过调整权重来考虑服务器的性能差异。
- 请求的处理时间是否相同：如果处理请求的时间差异较大，那么最少连接或最短响应时间算法可能更合适，因为这两种算法可以动态地根据服务器的负载情况进行负载均衡。
- 是否需要维持会话状态：如果需要维持会话状态，那么源地址哈希算法可能更合适，因为这种算法可以保证来自同一源IP地址的请求总是被分配到同一台服务器。
- 是否需要缓存：如果需要缓存，那么URL哈希算法可能更合适，因为这种算法可以保证同一URL的请求总是被分配到同一台服务器。
- 服务器数量是否会频繁变化：如果服务器数量会频繁变化，那么轮询或最少连接算法可能更合适，因为这两种算法不依赖于服务器的数量。
