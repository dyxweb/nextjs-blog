## 虚拟DOM
- 原生的JavaScript我们直接对DOM进行创建和更改，而React会先将JSX代码转换成一个JavaScript对象，然后再将这个JavaScript对象转换成真实DOM。这个JavaScript对象就是所谓的虚拟DOM。
- 当需要创建或更新元素时，React会先对虚拟DOM对象进行创建或更改，然后再将虚拟DOM对象渲染成真实DOM。
### 虚拟DOM优点
#### 提高开发效率，代码逻辑更易维护
- 使用JavaScript，我们很大的关注点在于如何更新DOM。使用React不必自己去完成属性操作、事件处理、DOM更新，React会替我们完成这一切。
- 我们可以更关注我们的业务逻辑而非DOM操作，可大大提升我们的开发效率。
#### 性能提升 **浏览器在处理DOM的时候会很慢，处理JavaScript会很快**
- 直接操作DOM是非常耗费性能的，React使用虚拟DOM也是无法避免操作DOM的。如果是首次渲染，虚拟DOM并不具有优势，甚至要进行更多的计算，消耗更多的内存。
- 虚拟DOM的优势在于React的Diff算法和批处理策略，React在更新真实DOM之前，提前计算好了如何进行更新和渲染DOM。实际上这个计算过程我们在直接操作DOM时，也是可以自己判断和实现的，但是一定会耗费非常多的精力和时间，而且往往我们自己做的是不如React好，React帮助我们计算如何更高效的更新，而不是它比DOM操作更快，在这个过程中React帮助我们提升了性能。
- 虚拟DOM进行频繁修改不会引起页面的绘制，然后**一次性比较并修改**真实DOM中需要改的部分，最后在真实DOM中进行排版与重绘，减少排版重绘的次数，真实DOM频繁排版与重绘的效率是相当低的。
- 减弱频繁的大面积重绘引发的性能问题。虚拟DOM有效降低大面积(真实DOM节点)的重绘与排版，因为最终与真实DOM比较差异，可以只渲染局部。
- 只有虚拟DOM并不能提升性能，虚拟DOM + Diff算法才能真正的提高性能。
#### 事件机制跨浏览器兼容
- React基于虚拟DOM自己实现了一套事件机制，自己模拟了事件冒泡和捕获的过程，采用事件代理，批量更新等方法，抹平了各个浏览器的事件兼容性问题。
#### 跨平台兼容
- 以React Native为例子，根据虚拟DOM绘制出对应平台的ui层。
### 虚拟DOM缺点
- ⾸次渲染⼤量DOM时，由于多了⼀层虚拟DOM的计算，会⽐直接操作真实DOM慢。
- ⽆法进⾏极致优化，虽然虚拟DOM + 合理的优化，⾜以应对绝⼤部分应⽤的性能需求，但在⼀些性能要求极⾼的应⽤中虚拟DOM⽆法进⾏针对性的极致优化。
### 使用了虚拟DOM不一定会比直接渲染真实DOM快
- React框架给的保证是在不需要手动优化的情况下，可以提供过得去的性能。
- 浏览器在处理DOM的时候会很慢，处理JavaScript会很快，Diff过程是JS层面的操作，用途就是减少后续的真实DOM操作。
### 虚拟DOM的结构
```
{
  "type": "div", 
  "props": {
    "id": "foo", 
    "children": [
      {
        "type": "a", 
        "props": {
          "children": [
            {
              "type": "TEXT_ELEMENT", 
              "props": {
                "nodeValue": "bar", 
                "children": []
              }
            }
          ]
        },
        key: null,
        ref: null,
        $$typeof: Symbol.for('react.element'), // 标识React元素
      }, 
      {
        "type": "b", 
        "props": {
          "children": []
        },
        key: null,
        ref: null,
        $$typeof: Symbol.for('react.element'), // 标识React元素
      }
    ]
  }
}
```
### React元素中$$typeof的作用
- 用于标识React元素，该属性值为Symbol，主要为了防止XSS攻击。
- React在处理元素时通过$$typeof就能够识别出非法元素(伪造元素)。
- 浏览器不支持Symbol时React仍然会加上$$typeof字段以保证一致性，会设置一个数字0xeac7，因为0xeac7看起来有点像React。
### 操作DOM会比操作JS代价更大
- 访问和修改DOM元素需要通过浏览器的底层接口提供的API来实现，与直接在内存中操作JavaScript对象相比，通过浏览器接口进行DOM操作涉及到更多的层级和复杂性，从而导致性能开销增加。
- DOM操作引起页面重新渲染和重排，当对DOM元素进行修改时，浏览器需要重新计算元素的布局和样式，并重新渲染整个页面或部分页面。这个过程称为重排（reflow） 和重绘（repaint），它对于页面的性能和响应时间有一定的影响，增加了页面的负担和性能开销。
### 减少DOM操作的优化措施
- 批量操作：将多个DOM操作合并成一个批量操作，减少页面的重排和重绘次数。
- 使用文档片段（DocumentFragment）：将多个DOM元素的操作放在文档片段中，然后一次性插入到页面中，减少页面渲染的次数。
- 缓存DOM查询结果：避免多次查询同一个DOM元素，将查询结果缓存在变量中以提高性能。
- 使用事件委托：将事件处理程序绑定在父元素上，通过事件冒泡机制处理子元素的事件，减少事件绑定的数量。
